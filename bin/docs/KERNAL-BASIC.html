<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>X16 KERNAL/BASIC/DOS ROM</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="github-pandoc.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="commander-x16-basickernaldos-rom">Commander X16 BASIC/KERNAL/DOS ROM</h1>
<p>This is the Commander X16 ROM containing BASIC, KERNAL and DOS. BASIC and KERNAL are derived from the <a href="https://github.com/mist64/c64rom">Commodore 64 versions</a>.</p>
<ul>
<li>BASIC is fully compatible with Commodore BASIC V2.</li>
<li>KERNAL
<ul>
<li>supports the complete $FF81+ API.</li>
<li>has the same zero page and $0200-$033C memory layout as the C64.</li>
<li>does not support tape (device 1).</li>
</ul></li>
</ul>
<h2 id="new-features">New Features</h2>
<ul>
<li>F-keys: F1: <code>LIST</code> F2: <code>MONITOR</code> F3: <code>RUN</code> F4: &lt;switch 40/80&gt; F5: <code>LOAD</code> F6: <code>SAVE"</code> F7: <code>DOS"$</code> F8: <code>DOS</code></li>
<li>New BASIC instructions
<ul>
<li><code>MONITOR</code>: see below.</li>
<li><code>DOS</code>: no argument: read disk status. "8" or "9" as an argument: switch default drive. "$" as an argument: show directory. all other arguments: send DOS command</li>
<li><code>VPEEK</code>(bank, offset), <code>VPOKE</code> bank, offset, value to access video memory. "offset" is 16 bits, "bank" is bits 16-19 of the linear address. Note that the tokens for the new BASIC commands have not been finalized yet, so loading a BASIC program that uses the new keywords in a future version of the ROM will break!</li>
</ul></li>
<li>Support for <code>$</code> and <code>%</code> in BASIC expressions for hex and binary</li>
<li><code>LOAD</code> prints the start and end(+1) addresses</li>
<li>Integrated Monitor derived from the <a href="https://github.com/mist64/final_cartridge">Final Cartridge III</a>.
<ul>
<li><code>O00</code>..<code>OFF</code> to switch ROM and RAM banks</li>
<li><code>OV0</code>..<code>OV4</code> to switch to video address space</li>
</ul></li>
<li>FAT32-formatted SD card as drive 8 as a full IEC (TALK/LISTEN &amp; CBM DOS) compatible device:
<ul>
<li>read directory</li>
<li>load file</li>
<li>send "I" command</li>
<li>read status</li>
<li>everything else is unimplemented</li>
</ul></li>
<li>Some new KERNAL APIs (to be documented)</li>
</ul>
<h2 id="big-todos">Big TODOs</h2>
<ul>
<li>DOS needs more features.</li>
<li>BASIC needs more features.</li>
<li>RS232 and IEC are not working.</li>
<li>PS/2 and SD have issues on real hardware.</li>
</ul>
<h2 id="rom-map">ROM Map</h2>
<ul>
<li>fixed ROM ($E000-$FFFF): KERNAL</li>
<li>banked ROM ($C000-$DFFF):
<ul>
<li>bank 0: BASIC</li>
<li>bank 1: UTIL (monitor)</li>
<li>bank 2: DOS</li>
</ul></li>
</ul>
<h2 id="ram-map">RAM Map</h2>
<ul>
<li>fixed RAM:
<ul>
<li>$0000-$0400 KERNAL/BASIC/DOS system variables</li>
<li>$0400-$0800 currently unused</li>
<li>$0800-$9F00 BASIC RAM</li>
</ul></li>
<li>banked RAM:
<ul>
<li>banks 0-254: free for applications</li>
<li>bank 255: DOS buffers and variables</li>
</ul></li>
</ul>
<h2 id="credits">Credits</h2>
<p>KERNAL and BASIC additions, DOS: Michael Steil, <a href="https://www.pagetable.com/">www.pagetable.com</a>; 2-clause BSD license</p>
<p>FAT32 and SD card drivers: Copyright (c) 2018 Thomas Woinke, Marko Lauke, <a href="https://steckschwein.de">www.steckschein.de</a>; MIT License</p>
<h2 id="release-notes">Release Notes</h2>
<h3 id="release-30">Release 30</h3>
<ul>
<li>support for 13 keyboard layouts; cycle through them using F9</li>
<li>GETJOY call will fall back to keyboard (cursor/Ctrl/Alt/Space/Return), see Programmer's Reference Guide on how to use it</li>
<li>startup message now shows ROM revision</li>
<li>$FF80 contains the prerelease revision (negated)</li>
<li>the 60 Hz IRQ is now generated by VERA VSYNC</li>
<li>fix: VPEEK tokenization</li>
<li>fix: CBDOS was not correctly preserving the RAM bank</li>
<li>fix: KERNAL no longer uses zero page $FC-$FE</li>
</ul>
</body>
</html>
